<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scarey Weather - Kindersley, SK</title>
    <style>
        :root { 
            --bg: #f0f2f5; 
            --card: #ffffff; 
            --text-main: #1a1a1a; 
            --text-sub: #65676b; 
            --accent: #0084ff; 
            --high: #ff4757;
            --low: #2ed573;
            --kindersley-blue: #a5b1c2;
            --quote-bg: #e4e6eb;
        }
        
        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            transition: background-color 1.5s ease;
        }
        
        header { margin-top: 40px; text-align: center; width: 90%; }
        h1 { margin: 0; font-weight: 800; letter-spacing: -1px; font-size: 2.5rem; color: var(--text-main); text-transform: uppercase; }
        .location { font-size: 0.9rem; color: var(--text-sub); font-weight: 600; letter-spacing: 1px; margin-bottom: 5px; }
        #timestamp { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 20px; }

        #quote-container {
            background: var(--quote-bg);
            padding: 15px 25px;
            border-radius: 50px;
            margin-bottom: 30px;
            max-width: 80%;
            text-align: center;
            font-style: italic;
            font-weight: 500;
            color: #4b4b4b;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            width: 90%; 
            max-width: 1100px; 
        }
        
        .card { 
            background: var(--card); 
            padding: 30px; 
            border-radius: 24px; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .icon-bg {
            position: absolute;
            top: 20px;
            right: 20px;
            opacity: 0.1;
            color: var(--accent);
        }
        
        .label { color: var(--text-sub); text-transform: uppercase; font-size: 0.75rem; font-weight: 700; letter-spacing: 1.2px; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;}
        .main-reading { display: flex; align-items: baseline; justify-content: center; margin-bottom: 5px; }
        .secondary-reading { text-align: center; font-size: 1.1rem; color: var(--text-sub); font-weight: 500; margin-bottom: 20px; }
        .value { font-size: 4rem; font-weight: 800; color: var(--text-main); line-height: 1; }
        .unit { font-size: 1.5rem; color: var(--text-sub); font-weight: 500; margin-left: 8px; }
        
        .stats-24h { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            border-top: 1px solid #eee; 
            padding-top: 20px; 
        }
        
        .stat-item { text-align: center; }
        .stat-label { font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; display: block; margin-bottom: 4px; }
        .stat-val { font-size: 1.1rem; font-weight: 700; }
        .stat-val.high { color: var(--high); }
        .stat-val.low { color: var(--low); }
        
        footer { margin-top: auto; padding: 40px; color: var(--text-sub); font-style: italic; font-size: 0.9rem; text-align: center; line-height: 1.6; }
        body.below-zero { background-color: var(--kindersley-blue); }
        svg { vertical-align: middle; }
    </style>
</head>
<body>

    <header>
        <div class="location">TREATY 6 • KINDERSLEY, SK</div>
        <h1>Scarey Weather</h1>
        <div id="timestamp">Updating Station Data...</div>
    </header>

    <div id="quote-container">
        "If you don't like the weather in Saskatchewan, wait five minutes."
    </div>

    <div class="dashboard">
        <!-- Temperature Card -->
        <div class="card">
            <div class="icon-bg">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></svg>
            </div>
            <div class="label">Temperature</div>
            <div class="main-reading"><span class="value" id="temp-val">--</span><span class="unit">°C</span></div>
            <div class="secondary-reading" id="temp-f-val">-- °F</div>
            <div class="stats-24h">
                <div class="stat-item"><span class="stat-label">24H High</span><span class="stat-val high" id="temp-high">--</span></div>
                <div class="stat-item"><span class="stat-label">24H Low</span><span class="stat-val low" id="temp-low">--</span></div>
            </div>
        </div>

        <!-- Humidity Card -->
        <div class="card">
            <div class="icon-bg">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            </div>
            <div class="label">Humidity</div>
            <div class="main-reading"><span class="value" id="humi-val">--</span><span class="unit">%</span></div>
            <div class="secondary-reading">&nbsp;</div>
            <div class="stats-24h">
                <div class="stat-item"><span class="stat-label">24H High</span><span class="stat-val high" id="humi-high">--</span></div>
                <div class="stat-item"><span class="stat-label">24H Low</span><span class="stat-val low" id="humi-low">--</span></div>
            </div>
        </div>

        <!-- Pressure Card -->
        <div class="card">
            <div class="icon-bg">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4"/><path d="M12 16V8"/></svg>
            </div>
            <div class="label">Sea-Level Pressure</div>
            <div class="main-reading"><span class="value" id="pres-val">--</span><span class="unit">kPa</span></div>
            <div class="secondary-reading" id="pres-hpa-val">-- hPa</div>
            <div class="stats-24h">
                <div class="stat-item"><span class="stat-label">24H High</span><span class="stat-val high" id="pres-high">--</span></div>
                <div class="stat-item"><span class="stat-label">24H Low</span><span class="stat-val low" id="pres-low">--</span></div>
            </div>
        </div>
    </div>

    <footer>
        "In the midst of winter, I found there was, within me, an invincible summer."<br>
        <small>Live from the ScareySci Lab • Kindersley, SK</small>
    </footer>

    <script>
        const USER = 'scareysci';
        const KEY = 'aio_vvWE' + '28bkXvSbG2RsFjLaJQxvOJTn';
        const FEEDS = ['temperature', 'humidity', 'pressure'];
        const ELEVATION_M = 683; 

        const wisdom = [
            { min: 30, text: "It's a dry heat, but the mosquitoes are the size of standard drones." },
            { min: 20, max: 30, text: "The perfect Saskatchewan day. Take a picture, it'll change in five minutes." },
            { min: 10, max: 20, text: "Bunny hug weather. Finally." },
            { min: 0, max: 10, text: "T-shirt weather for most of Kindersley. Winter jacket weather for everyone else." },
            { min: -10, max: 0, text: "Just a light frost. Your car will probably start... probably." },
            { min: -25, max: -10, text: "Standard winter. If the wind isn't howling, it's actually quite nice!" },
            { min: -40, max: -25, text: "Colder than a brass toilet seat on the shady side of an iceberg." },
            { max: -40, text: "Absolute Zero. Even the mother-in-law's glare is frozen today." }
        ];

        let currentTempC = 15; 

        function getWisdom(temp) {
            return wisdom.find(w => (w.min === undefined || temp >= w.min) && (w.max === undefined || temp < w.max))?.text || "Saskatchewan: Where the wind blows.";
        }

        function adjustPressure(stationPressureHpa, tempC) {
            return stationPressureHpa * Math.pow(1 - (0.0065 * ELEVATION_M) / (tempC + 0.0065 * ELEVATION_M + 273.15), -5.257);
        }

        function toFahrenheit(celsius) {
            return (celsius * 1.8) + 32;
        }

        async function updateData() {
            try {
                const tempRes = await fetch(`https://io.adafruit.com/api/v2/${USER}/feeds/temperature/data/last`, {
                    headers: { 'X-AIO-Key': KEY }
                });
                if (tempRes.ok) {
                    const tempData = await tempRes.json();
                    currentTempC = parseFloat(tempData.value);
                }
            } catch (e) { console.error("Temp pre-fetch failed", e); }

            for (let f of FEEDS) {
                const idPrefix = f.substring(0, 4);
                try {
                    const res = await fetch(`https://io.adafruit.com/api/v2/${USER}/feeds/${f}/data/last`, {
                        headers: { 'X-AIO-Key': KEY }
                    });
                    
                    if (!res.ok) continue;
                    const data = await res.json();
                    if (data && data.value) {
                        let val = parseFloat(data.value);
                        
                        if (f === 'pressure') {
                            const seaLevelHpa = adjustPressure(val, currentTempC);
                            const seaLevelKpa = seaLevelHpa / 10; // 1 hPa = 0.1 kPa
                            document.getElementById(`${idPrefix}-val`).innerText = seaLevelKpa.toFixed(2);
                            document.getElementById(`pres-hpa-val`).innerText = seaLevelHpa.toFixed(1) + " hPa";
                        } else if (f === 'temperature') {
                            document.getElementById(`${idPrefix}-val`).innerText = val.toFixed(1);
                            document.getElementById('temp-f-val').innerText = toFahrenheit(val).toFixed(1) + " °F";
                            document.getElementById('timestamp').innerText = "Last Signal: " + new Date(data.created_at).toLocaleTimeString();
                            document.getElementById('quote-container').innerText = `"${getWisdom(val)}"`;
                            if (val < 0) document.body.classList.add('below-zero');
                            else document.body.classList.remove('below-zero');
                        } else {
                            document.getElementById(`${idPrefix}-val`).innerText = val.toFixed(1);
                        }
                    }

                    const histRes = await fetch(`https://io.adafruit.com/api/v2/${USER}/feeds/${f}/data/chart?hours=24`, {
                        headers: { 'X-AIO-Key': KEY }
                    });
                    if (histRes.ok) {
                        const histData = await histRes.json();
                        if (histData && histData.data) {
                            let points = histData.data.map(p => parseFloat(p[1])).filter(v => !isNaN(v));
                            if (f === 'pressure') {
                                points = points.map(p => adjustPressure(p, currentTempC) / 10);
                            }
                            if (points.length > 0) {
                                document.getElementById(`${idPrefix}-high`).innerText = Math.max(...points).toFixed(f === 'pressure' ? 2 : 1);
                                document.getElementById(`${idPrefix}-low`).innerText = Math.min(...points).toFixed(f === 'pressure' ? 2 : 1);
                            }
                        }
                    }
                } catch (e) { console.error(e); }
            }
        }

        updateData();
        setInterval(updateData, 30000);
    </script>
</body>
</html>
