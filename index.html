<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environmental Science 20 Textbook Index</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using the system default for 'Inter' */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for centering on large screens */
        .full-center-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        /* Smooth transitions for links/buttons */
        .chapter-link {
            transition: all 0.2s ease;
        }
        .chapter-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="p-4 bg-gray-50 full-center-container">
    <div class="bg-white rounded-2xl shadow-2xl shadow-green-200/50 p-6 md:p-12 max-w-5xl w-full text-center border-t-8 border-green-600">
        <!-- Header Section -->
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2 tracking-tight">
            Environmental Science 20
        </h1>
        <p class="text-gray-500 mb-10 text-lg">
            Course Textbook & Chapter Index
        </p>
        
        <!-- Search Bar Section -->
        <div class="mb-10 p-5 bg-gray-50 rounded-xl border border-gray-200 shadow-inner">
            <form id="searchForm" class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="searchInput" placeholder="Search a term like 'Salinity' or 'Biomes'..." 
                       class="w-full px-5 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-500/50 focus:border-green-500 transition duration-150 shadow-md">
                <button type="submit" class="px-6 py-3 bg-green-600 text-white font-bold rounded-xl shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-[1.01] flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Search Index
                </button>
            </form>
            
            <div id="messageBox" class="mt-4 text-sm font-semibold text-red-500 hidden"></div>
            
            <!-- Search Results Display -->
            <div id="results" class="mt-6 text-left space-y-4">
                <!-- Results will be injected here -->
            </div>
        </div>

        <!-- External Link / Call to Action -->
        <div class="mb-10">
            <a href="https://envsci20textbook.vercel.app/stbud.html"
               class="inline-block w-full py-4 text-xl font-extrabold text-white bg-blue-600 rounded-xl shadow-xl hover:bg-blue-700 transition duration-300 transform hover:scale-[1.01] uppercase tracking-wider"
               target="_blank">
                Launch Environmental Science Study Buddy
            </a>
        </div>

        <!-- Chapter Index -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-10 gap-y-12">

            <!-- Unit 1 -->
            <div class="mb-0">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b-2 border-blue-200 pb-3 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 21.5l-7.7-4.4v-8.8L12 3.8l7.7 4.4v8.8L12 21.5z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-6l4-2.3m-8 2.3l4 2.3" />
                    </svg>
                    Unit 1: Aquatic Ecosystems
                </h2>
                <div class="grid grid-cols-1 gap-4">
                    <a href="part1.html" class="chapter-link p-5 bg-blue-500 text-white font-semibold rounded-xl shadow-lg hover:bg-blue-600">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 1</span>
                        Hydrologic Cycle
                    </a>
                    
                    <a href="part2.html" class="chapter-link p-5 bg-blue-500 text-white font-semibold rounded-xl shadow-lg hover:bg-blue-600">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 2</span>
                        Types of Aquatic Ecosystems
                    </a>

                    <a href="part3.html" class="chapter-link p-5 bg-blue-500 text-white font-semibold rounded-xl shadow-lg hover:bg-blue-600">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 3</span>
                        Abiotic Factors of Aquatic Ecosystems
                    </a>
                </div>
            </div>

            <!-- Unit 2 -->
            <div>
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b-2 border-green-200 pb-3 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m-4-4h1m-1 4h1m4-4h1m-1 4h1m-4-4h1m-1 4h1m-4-4h1m-1 4h1m9-4h1m-1 4h1" />
                    </svg>
                    Unit 2: Terrestrial Ecosystems
                </h2>
                <div class="grid grid-cols-1 gap-4">
                    <a href="tepart1.html" class="chapter-link p-5 bg-green-600 text-white font-semibold rounded-xl shadow-lg hover:bg-green-700">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 4</span>
                        Introduction to Terrestrial Ecosystems and Soil
                    </a>
                    
                    <a href="tepart2.html" class="chapter-link p-5 bg-green-600 text-white font-semibold rounded-xl shadow-lg hover:bg-green-700">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 5</span>
                        Exploring Producers
                    </a>
                    
                    <a href="tepart3.html" class="chapter-link p-5 bg-green-600 text-white font-semibold rounded-xl shadow-lg hover:bg-green-700">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 6</span>
                        Biodiversity
                    </a>

                    <a href="game.html" class="chapter-link p-5 bg-teal-500 text-white font-semibold rounded-xl shadow-lg hover:bg-teal-600">
                        <span class="text-xs font-light opacity-80 block mb-1">Game</span>
                        Review Activity: Ecosystem Builder
                    </a>

                    <a href="tepodcast.html" class="chapter-link p-5 bg-purple-600 text-white font-semibold rounded-xl shadow-lg hover:bg-purple-700">
                        <span class="text-xs font-light opacity-80 block mb-1">Podcast</span>
                        Terrestrial Ecosystem - The Podcast
                    </a>
                </div>
            </div>

            <!-- Unit 3: NEW SECTION ADDED HERE -->
            <div class="mb-0">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b-2 border-indigo-200 pb-3 flex items-center">
                    <!-- Cloud/Atmosphere Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                    Unit 3: Atmosphere and Human Impact
                </h2>
                <div class="grid grid-cols-1 gap-4">
                    <a href="atm1.html" class="chapter-link p-5 bg-indigo-500 text-white font-semibold rounded-xl shadow-lg hover:bg-indigo-600">
                        <span class="text-xs font-light opacity-80 block mb-1">Chapter 7</span>
                        Atmosphere, Climate and Human Stewardship
                    </a>

                    <!-- NEW PODCAST BUTTON -->
                    <a href="atm2.html" class="chapter-link p-5 bg-purple-600 text-white font-semibold rounded-xl shadow-lg hover:bg-purple-700">
                        <span class="text-xs font-light opacity-80 block mb-1">Podcast</span>
                        Atmosphere & Climate: The Podcast
                    </a>

                    <!-- NEW ASSIGNMENT BUTTON -->
                    <a href="atm3.html" class="chapter-link p-5 bg-red-600 text-white font-semibold rounded-xl shadow-lg hover:bg-red-700">
                        <span class="text-xs font-light opacity-80 block mb-1">Assignment</span>
                        Protocol Zero - Assignment
                    </a>
                    
                    <div class="p-4 bg-gray-100 text-gray-600 font-medium rounded-xl border border-gray-300 shadow-inner italic flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        More Unit 3 chapters coming soon...
                    </div>
                </div>
            </div>

        </div> 
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchForm = document.getElementById('searchForm');
            const searchInput = document.getElementById('searchInput');
            const messageBox = document.getElementById('messageBox');
            const resultsDiv = document.getElementById('results');

            // --- MOCK CONTENT DATA (Expanded) ---
            const textbookData = [
                {
                    unit: 'Aquatic Ecosystems',
                    chapter: 'Chapter 1',
                    title: 'Hydrologic Cycle',
                    url: 'part1.html', 
                    htmlContent: `
                        <h3 id="evaporation" class="text-xl font-semibold mt-4">Evaporation and Transpiration</h3>
                        <p>Evaporation is the process where water changes from a liquid to a gas or vapor, fueled by **solar radiation** and wind. This phase change is crucial for atmospheric moisture.</p>
                        <p>Transpiration is similar but involves the loss of water from plant leaves, especially in forested biomes, contributing significantly to atmospheric humidity.</p>
                        <h3 id="condensation" class="text-xl font-semibold mt-4">Condensation and Precipitation</h3>
                        <p>Water vapor cools and condenses around tiny particles (condensation nuclei) to form clouds. When the clouds reach saturation, **precipitation** (rain, snow, hail, or sleet) occurs, returning the water to the surface reservoirs, which is a major source of freshwater.</p>
                        <h3 id="infiltration" class="text-xl font-semibold mt-4">Runoff and Infiltration</h3>
                        <p>Once water hits the ground, it either flows over the surface (**runoff**) or soaks into the ground (**infiltration**) to become groundwater. Excessive runoff can lead to erosion.</p>
                    `
                },
                {
                    unit: 'Aquatic Ecosystems',
                    chapter: 'Chapter 2',
                    title: 'Types of Aquatic Ecosystems',
                    url: 'part2.html',
                    htmlContent: `
                        <h3 id="freshwater" class="text-xl font-semibold mt-4">Freshwater Ecosystems (Lotic and Lentic)</h3>
                        <p>Lotic systems, such as **rivers** and streams, have unidirectional, moving water, influencing the adaptations of organisms found there. Lentic systems, like **lakes** and ponds, contain standing water and are often characterized by zones based on light penetration.</p>
                        <h3 id="marine" class="text-xl font-semibold mt-4">Marine Ecosystems (Oceans)</h3>
                        <p>The vast ocean ecosystems are characterized by high **salinity** (salt content), typically around 35 parts per thousand. They include productive zones like the coastal zone (estuaries, coral reefs) and the deep, open ocean. Ocean depth and light availability are key differentiators.</p>
                        <h3 id="estuaries" class="text-xl font-semibold mt-4">Estuaries and Wetlands</h3>
                        <p>Estuaries are transitional areas where freshwater rivers meet the ocean, resulting in brackish water and high biodiversity. Wetlands (swamps, marshes) are crucial for water filtration and flood control.</p>

                    `
                },
                {
                    unit: 'Aquatic Ecosystems',
                    chapter: 'Chapter 3',
                    title: 'Abiotic Factors of Aquatic Ecosystems',
                    url: 'part3.html',
                    htmlContent: `
                        <h3 id="temperature" class="text-xl font-semibold mt-4">Temperature and Dissolved Oxygen</h3>
                        <p>**Temperature** significantly influences the metabolism and reproductive cycles of aquatic organisms. Colder water usually holds more **dissolved oxygen** (DO), which is vital for fish and invertebrates. Thermal stratification in deep lakes affects DO levels.</p>
                        <h3 id="salinity_factors" class="text-xl font-semibold mt-4">Salinity, pH, and Light</h3>
                        <p>The **salinity** of water dictates which organisms can survive. Changes in **pH** (acidity/alkalinity) due to pollution like acid rain can stress or kill organisms. **Light penetration** determines the photic zone, where photosynthesis can occur.</p>
                        <h3 id="nutrients" class="text-xl font-semibold mt-4">Nutrient Concentration</h3>
                        <p>High concentrations of **nitrates** and **phosphates** (nutrients) often lead to eutrophication, causing algal blooms and ultimately reducing dissolved oxygen when the algae decompose.</p>
                    `
                },
                {
                    unit: 'Terrestrial Ecosystems',
                    chapter: 'Chapter 4',
                    title: 'Introduction to Terrestrial Ecosystems and Soil',
                    url: 'tepart1.html',
                    htmlContent: `
                        <h3 id="biomes" class="text-xl font-semibold mt-4">Defining Terrestrial Biomes</h3>
                        <p>Terrestrial ecosystems are organized into **biomes**, large regions primarily determined by climate factors like temperature and rainfall. Examples include the Taiga, Tropical Rainforests, and Savannas. Temperature and rainfall are the primary abiotic factors.</p>
                        <h3 id="soil_factors" class="text-xl font-semibold mt-4">Key Soil Factors</h3>
                        <p>**Soil composition** (sand, silt, clay ratio), **pH**, and **nutrient content** are critical **abiotic factors** influencing plant life. The **A-horizon** (topsoil) is the most biologically active layer.</p>
                    `
                },
                {
                    unit: 'Terrestrial Ecosystems',
                    chapter: 'Chapter 5',
                    title: 'Exploring Producers',
                    url: 'tepart2.html',
                    htmlContent: `
                        <h3 id="autotrophs" class="text-xl font-semibold mt-4">Autotrophs and Photosynthesis</h3>
                        <p>Producers, also known as **autotrophs**, form the base of every terrestrial food web. Most producers use **photosynthesis** (converting $\text{CO}_2$ and water into glucose and oxygen) to convert light energy into chemical energy, driving the entire ecosystem.</p>
                        <h3 id="chemosynthesis" class="text-xl font-semibold mt-4">Chemosynthesis</h3>
                        <p>While rare in terrestrial ecosystems, some organisms use **chemosynthesis** to create food from inorganic chemicals, often found in deep-sea vents or specific soil environments.</p>
                    `
                },
                {
                    unit: 'Terrestrial Ecosystems',
                    chapter: 'Chapter 6',
                    title: 'Biodiversity',
                    url: 'tepart3.html',
                    htmlContent: `
                        <h3 id="three_levels" class="text-xl font-semibold mt-4">Three Levels of Diversity</h3>
                        <p>**Biodiversity** is the variety of life in an area. It is measured at three levels: **genetic diversity** (variation within a species), **species richness** (number of different species), and **ecosystem diversity** (variety of habitats). Higher diversity generally leads to more stable ecosystems.</p>
                        <h3 id="hotspots" class="text-xl font-semibold mt-4">Biodiversity Hotspots</h3>
                        <p>A **biodiversity hotspot** is a biogeographic region with significant levels of biodiversity that is threatened by human habitation. These areas are critical for global conservation efforts due to their high number of endemic species.</p>
                    `
                },
                // --- NEW UNIT 3 DATA ADDED FOR SEARCH ---
                {
                    unit: 'Atmosphere and Human Impact',
                    chapter: 'Chapter 7',
                    title: 'Atmosphere, Climate and Human Stewardship',
                    url: 'atm1.html',
                    htmlContent: `
                        <h3 id="atmosphere_layers" class="text-xl font-semibold mt-4">Layers of the Atmosphere</h3>
                        <p>The atmosphere is divided into layers based on temperature trends: the **troposphere** (where weather occurs), stratosphere (home to the **ozone** layer), mesosphere, and thermosphere.</p>
                        <h3 id="climate_change" class="text-xl font-semibold mt-4">Climate Change and Greenhouse Gases</h3>
                        <p>Human activities are altering the composition of the atmosphere. The **greenhouse effect** is intensified by emissions of **carbon dioxide** and methane, leading to global warming and climate instability.</p>
                        <h3 id="stewardship" class="text-xl font-semibold mt-4">Human Stewardship</h3>
                        <p>Stewardship involves the responsible planning and management of resources. Reducing **ecological footprints** and transitioning to renewable energy are key aspects of modern environmental stewardship.</p>
                    `
                },
                {
                    unit: 'Atmosphere and Human Impact',
                    chapter: 'Podcast',
                    title: 'Atmosphere & Climate: The Podcast',
                    url: 'atm2.html',
                    htmlContent: `
                        <h3 id="podcast_intro" class="text-xl font-semibold mt-4">Listening to the Atmosphere</h3>
                        <p>In this episode, we explore the dynamic nature of our atmosphere, discussing weather patterns, climate change, and how human actions influence the air we breathe.</p>
                    `
                },
                {
                    unit: 'Atmosphere and Human Impact',
                    chapter: 'Assignment',
                    title: 'Protocol Zero - Assignment',
                    url: 'atm3.html',
                    htmlContent: `
                        <h3 id="protocol_zero" class="text-xl font-semibold mt-4">Protocol Zero Directive</h3>
                        <p>This assignment challenges students to develop a comprehensive action plan for immediate climate mitigation strategies, analyzing the tipping points of **global warming**.</p>
                    `
                }
            ];

            const extractSnippet = (text, searchTerm, contextLength = 80) => {
                const lowerText = text.toLowerCase();
                const lowerSearchTerm = searchTerm.toLowerCase();
                const index = lowerText.indexOf(lowerSearchTerm);

                if (index === -1) return null;

                // Calculate start and end indices for the snippet
                let startIndex = Math.max(0, index - contextLength);
                let endIndex = Math.min(text.length, index + lowerSearchTerm.length + contextLength);

                // Adjust to stop at previous sentence end or heading, if possible, for cleaner context
                // This is a simple approximation: look for '. ' before the start
                const startEllipsis = startIndex > 0;
                if (startEllipsis) {
                    const sentenceEnd = text.lastIndexOf('.', startIndex) + 1;
                    if (sentenceEnd > startIndex - contextLength + 10) { // Check if the sentence end is reasonably close
                        startIndex = sentenceEnd;
                    }
                }

                let snippet = text.substring(startIndex, endIndex).trim();

                // Highlight the search term (case insensitive)
                const regex = new RegExp(lowerSearchTerm.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1"), 'gi');
                snippet = snippet.replace(regex, (match) => `<span class="bg-yellow-200 font-bold text-gray-900 rounded px-1">${match}</span>`);

                // Add ellipses
                if (startIndex > 0) snippet = '... ' + snippet;
                if (endIndex < text.length) snippet = snippet + ' ...';

                return snippet;
            };

            searchForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const searchTerm = searchInput.value.trim();
                resultsDiv.innerHTML = '';
                messageBox.textContent = '';
                messageBox.classList.add('hidden');
                
                if (searchTerm.length < 3) {
                    messageBox.textContent = 'Please enter a search term with at least 3 characters.';
                    messageBox.classList.remove('hidden');
                    return;
                }

                let foundResults = 0;
                const parser = new DOMParser();

                textbookData.forEach(page => {
                    const tempDoc = parser.parseFromString(page.htmlContent, 'text/html');
                    const rawText = tempDoc.body.textContent || '';
                    const pageContent = rawText.toLowerCase();

                    if (pageContent.includes(searchTerm.toLowerCase())) {
                        foundResults++;
                        
                        const snippet = extractSnippet(rawText, searchTerm);

                        // Find closest heading (H3 is used for sections)
                        let closestHeading = 'Chapter Introduction';
                        let closestHeadingId = '';
                        let closestDistance = Infinity;
                        const searchTermIndex = pageContent.indexOf(searchTerm.toLowerCase());

                        tempDoc.body.querySelectorAll('h3[id]').forEach(h3 => {
                            const h3Index = pageContent.indexOf(h3.textContent.toLowerCase().trim().substring(0, 20));
                            if (h3Index !== -1 && h3Index <= searchTermIndex) {
                                const distance = searchTermIndex - h3Index;
                                if (distance < closestDistance) {
                                    closestDistance = distance;
                                    closestHeading = h3.textContent;
                                    closestHeadingId = h3.id;
                                }
                            }
                        });

                        const finalLinkUrl = closestHeadingId ? `${page.url}#${closestHeadingId}` : page.url;

                        const resultItem = document.createElement('div');
                        resultItem.className = 'p-4 bg-white border border-green-300 rounded-lg shadow-md hover:bg-green-50 transition duration-150 flex flex-col space-y-2';
                        
                        resultItem.innerHTML = `
                            <a href="${finalLinkUrl}" 
                                class="font-bold text-lg text-green-700 hover:text-green-800 transition duration-150 block w-fit"
                                title="Go to ${page.title} - ${closestHeading}">
                                ${page.chapter}: ${page.title}
                            </a>
                            <p class="text-sm text-gray-500">
                                <span class="font-semibold text-gray-700">Section:</span> ${closestHeading}
                            </p>
                            <p class="text-gray-600 text-base italic border-l-4 border-yellow-400 pl-3">
                                ${snippet}
                            </p>
                        `;
                        
                        resultsDiv.appendChild(resultItem);
                    }
                });

                if (foundResults > 0) {
                    messageBox.textContent = `${foundResults} result(s) found for "${searchTerm}".`;
                    messageBox.classList.remove('text-red-500');
                    messageBox.classList.add('text-green-700', 'font-bold');
                    messageBox.classList.remove('hidden');
                } else {
                    messageBox.textContent = `No matching results found for "${searchTerm}". Try 'salinity', 'evaporation', or 'biomes'.`;
                    messageBox.classList.add('text-red-500');
                    messageBox.classList.remove('text-green-700', 'font-bold');
                    messageBox.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>
